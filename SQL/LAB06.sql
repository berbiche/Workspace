--LABO06
--NICOLAS BERBICHE

--DROP DATABASE [AIR-TRANSAT]

--Q01
CREATE DATABASE [AIR-TRANSAT];
GO

--Q02
USE [AIR-TRANSAT];
GO

--Q03
CREATE TYPE TypeVille FROM VARCHAR(20) NOT NULL;
GO

--Q04 ET Q05
CREATE TABLE PILOTE
(NO_PILOTE  INTEGER PRIMARY KEY,
 NOM_PILOTE VARCHAR(25),
 NAS        CHAR(9) UNIQUE,
 VILLE      TypeVille,
 SALAIRE    MONEY CHECK (SALAIRE BETWEEN 20000 AND 80000));
GO

--Q06 ET Q07
CREATE TABLE AVION
(NO_AVION INTEGER PRIMARY KEY,
 CAPACITE INTEGER,
 MODELE   CHAR(4) DEFAULT 'A300',
 AEROPORT TypeVille);
GO

--Q08
CREATE TABLE VOL
(NO_VOL        INTEGER,
 NO_AVION      INTEGER,
 NO_PILOTE     INTEGER,
 V_DEPART      TypeVille,
 V_DESTINATION TypeVille,
 H_DEPART      DATETIME2,
 H_DESTINATION DATETIME2);
GO

--Q09
ALTER TABLE VOL	ALTER COLUMN NO_VOL INTEGER NOT NULL;
ALTER TABLE VOL	ALTER COLUMN NO_AVION INTEGER NOT NULL;
ALTER TABLE VOL	ALTER COLUMN NO_PILOTE INTEGER NOT NULL;
GO

ALTER TABLE VOL
ADD 
	CONSTRAINT FK_NO_AVION  FOREIGN KEY (NO_AVION)  REFERENCES AVION  (NO_AVION),
	CONSTRAINT FK_NO_PILOTE FOREIGN KEY (NO_PILOTE) REFERENCES PILOTE (NO_PILOTE),
	CONSTRAINT CK_VILLE     CHECK (V_DEPART != V_DESTINATION),
	CONSTRAINT CK_HEURE     CHECK (H_DESTINATION > H_DEPART);
GO

--Q10
INSERT INTO PILOTE (NO_PILOTE,NOM_PILOTE,VILLE,NAS,SALAIRE)
VALUES (2,'Pierre','Granby',NULL,72500),
	   (3,'Pierre','Sherbrooke',273501344,65000),
	   (4,'Picher','Maniwaki',273501345,25000),
	   (5,'Guillaume','Maniwaki',273501346,25000),
	   (6,'Picher','Granby',273501347,30000),
	   (7,'Benoit','Maniwaki',273501348,52500),
	   (8,'Guillaume','Sherbrooke',273501349,25000),
	   (9,'Guillaume','Sherbrooke',273501350,40000),
	   (10,'Serge','Maniwaki',273501341,59000);
GO

--Q11
INSERT INTO AVION (NO_AVION,MODELE,CAPACITE,AEROPORT)
VALUES (101,'',300,'Maniwaki'),
	   (102,'A330',300,'Granby'),
	   (103,'',300,'Sherbrooke'),
	   (104,'A330',300,'Maniwaki'),
	   (105,'A330',300,'Maniwaki'),
	   (106,'A320',300,'Granby'),
	   (107,'A320',300,'Maniwaki'),
	   (108,'A330',300,'Sherbrooke'),
	   (109,'A350',500,'Sherbrooke');
GO

--Q12
INSERT INTO VOL (NO_VOL,NO_PILOTE,NO_AVION,H_DEPART,V_DEPART,H_DESTINATION,V_DESTINATION)
VALUES (1002, 3, 104, '2016-11-18 2:00:00 PM', 'Maniwaki', '2016-11-18 2:20:00 PM', 'Granby'),
	(1003, 4, 105, '2016-11-18 1:00:00 AM', 'Sherbrooke', '2016-11-18 2:05:00 AM', 'Granby'),
	(1004, 2, 101, '2016-11-18 12:00:00 AM', 'Sherbrooke', '2016-11-19 2:20:00 PM', 'Maniwaki'),
	(1005, 3, 101, '2016-11-18 12:00:00 AM', 'Maniwaki', '2016-11-19 2:20:00 PM', 'Laval'),
	(1006, 4, 107, '2016-11-18 9:00:00 AM', 'Granby', '2016-11-19 2:20:00 AM', 'Maniwaki'),
	(1007, 5, 101, '2016-11-18 10:00:00 AM', 'Sherbrooke', '2016-11-19 2:20:00 AM', 'Laval'),
	(1008, 6, 101, '2016-11-18 7:00:00 PM', 'Laval', '2016-11-19 2:20:00 PM', 'Maniwaki'),
	(1009, 7, 106, '2016-11-18 4:00:00 PM', 'Sherbrooke', '2016-11-19 2:20:00 PM', 'Maniwaki'),
	(1010, 2, 109, '2016-11-18 8:00:00 AM', 'Granby', '2016-11-19 2:20:00 AM', 'Sherbrooke'),
	(1011, 3, 107, '2016-11-18 6:30:00 PM', 'Granby', '2016-11-19 2:20:00 PM', 'Sherbrooke'),
	(1012, 9, 109, '2016-11-18 1:00:00 AM', 'Granby', '2016-11-18 2:20:00 AM', 'Alma');
GO